<!DOCTYPE html>
<html>

<head>
    <title>Math And Color</title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
      <link rel="stylesheet" type="text/css" href="style.css" />

</head>
<body>
    <div id="bannerDivId">
        <h1>Learn And Color</h1>
    </div>
<div id="containerDivId" class="container">
    <div class="leftdiv"  id="leftDivId">
        <fieldset>
            <label for="contentTypeId">Content Type:</label>
            <select
                class="form-control" type="text" id="contentTypeId" onchange="onContentChange()">
                <option>Text</option>
                <option>Numeric</option>
            </select>
            <br/>
            <label id="numberALabelId" for="numberAId">A:</label>
            <input class="form-control" type="name" maxlength="5" size="4" id="numberAId" placeholder="A"/>
            <br/>
         	<label id="operatorLabelId" for="operatorId">Operator:</label> 
            <select
				class="form-control" type="text" id="operatorId" style="width:128px;">
				<option>+</option>
				<option>-</option>
				<option>x</option>
				<option>&divide</option>
                <option>%</option>
			</select>
            <br/>
            <label id="numberBLabelId" for="numberBId">B:</label>
            <input class="form-control" type="name" maxlength="5" size="4" id="numberBId" placeholder="B"/>
            <label id="textLabelId" for="textId">Text:</label>
            <input class="form-control" type="name" maxlength="5" size="4" id="textId" placeholder="Text To Appear"/>
        </fieldset>
        <fieldset>
            <button class="form-control" id="doneId" onclick="validateInput()">Add To Image</button>
            <br/>
            <button class="form-control" id="hideId" onclick="hideInputs()">Hide Inputs</button>
            <br/>
            <button class="form-control" id="configurationId" onclick="toggleAdvanced()">Advanced</button>
        </fieldset>
        <fieldset>
            <button class="form-control" id="showOtherImagesId" onclick="showOtherImages()">Other Images</button>
            <br/>
            <button class="form-control" id="prefillImageId" onclick="prefillImage()">Prefill Image</button>
            <br/>
            <input id="image_from_list" name="image_from_list" type="text" maxlength="5" size="4" value="none"  />
            <br/>
            <img src="images/butterfly.jpg" col="images/butterfly.jpg" border="0" width="50 px" height="50 px" 
            />
            <br/>
            <img src="images/puppy.gif" col="images/puppy.gif" border="0" width="50 px" height="50 px"
            />
            <br/>
            <img src="images/teddyBear.jpg" col="images/teddyBear.jpg" border="0" width="50 px" height="50 px"
            />
            <img src="images/dora.gif" col="images/dora.gif" border="0" width="50 px" height="50 px"
            />
            <br/>
        </fieldset>
    </div>
    <!--http://stackoverflow.com/questions/12886286/addeventlistener-for-keydown-on-canvas
    Added tab index, to make canvas focusable. Unlike other html elements, it is NOT
    focusable by default.
    -->

    <!--<canvas id="myCanvas" width="1000" height="1000" style="border:1px solid #d3d3d3;" tabindex="1" 
    onclick="mouseMoveHandler(this,event)">
        Your browser does not support the HTML5 canvas tag.
    </canvas>-->

    <div id="wrapper" class="formgroup">
        <!--
        http://stackoverflow.com/questions/18431332/delete-only-text-but-not-the-image-using-canvas
        http://jsfiddle.net/m1erickson/fg5sV/
        INFO: both canvas and image overlap.Only the text goes on to the canvas.
        -->
        <img id="bkImage" src="images/dora.gif"
         width=1000 height=1000></canvas>
        <canvas id="myCanvas" width=1000 height=1000 tabindex="1" 
    onclick="mouseMoveHandler(this,event)">
        Your browser does not support the HTML5 canvas tag.
        </canvas>
    </div>

    <div class="rightdiv" id="rightDivId">
        <fieldset class="fieldSet1">
            <label id="contentCoordinateGroupLabelId" for="contentCoordinateGroupId" >Add/Edit #:</label>
            <div id="editMessageDivId"></div>
            <input class="form-control" type="hidden" id="contentCoordinateGroupId" size="4" placeholder="-1 or 1,2"/>
            <br/>
            <label for="xId">X:</label>
            <input class="form-control" type="name" id="xId" size="4" placeholder="X"/>
            <br/>
            <label for="yId">Y:</label>
            <input class="form-control" type="name" id="yId" size="4" placeholder="Y"/>
            <br/>
            <label for="fontSizeId">Font Size:</label>
            <input class="form-control" type="name" id="fontSizeId" size="4" value="40"/>
        </fieldset>    
    </div>

    </div>
    <script type="text/javascript">

        var FONT_SIZE = $('#fontSizeId').val();
        var CONTENT_TYPE_NUMERIC="Numeric";
        var CONTENT_TYPE_TEXT="Text";
        var mouseCoordinate;
        var contentCoordinateGroupHistory=[];


        window.onload = function() {
            $("#bannerDivId").width(1600);     
            draw();
            toggleAdvanced();
            onContentChange();
        };
        //INFO: outside of onload

        $("div#leftDivId img").click(function () {
            $("div#leftDivId img").attr("border","0");
            $(this).attr("border","4");
            $("input#image_from_list").val($(this).attr("col"));
            $('#bkImage').attr('src',$(this).attr("col"));
        }); 

        function toggleAdvanced(){
            $(".fieldSet1").toggle(); 
        }

        function addToHistory(contentCoordinateGroup){
            contentCoordinateGroup.setId(Number(contentCoordinateGroupHistory.length+1));
            contentCoordinateGroupHistory.push(contentCoordinateGroup);
        }

        function erase(canvas) {
            var context = canvas.getContext("2d");
            context.clearRect(0, 0, canvas.width, canvas.height);
        }
        function draw() {
            var canvas = document.getElementById("myCanvas");
            var context = canvas.getContext("2d");
            context.font = FONT_SIZE+"pt Calibri";
            context.textAlign="left";
            context.fillText("Name:", 30, FONT_SIZE);
            //Fill your name
            context.fillText("__________", 30, (3*Number(FONT_SIZE)));
            context.fillText("_______", 30, (5*Number(FONT_SIZE)));
        }

        //INFO: capture the last coordinate of mouse, by mouse listener.
        //on key down, write to the last known coordinate of the mouse.

        function mouseMoveHandler(canvas, event) {
            showInputs();
            mouseCoordinate = getMouseCoordinate(canvas, event);
            console.log("clicked at "+mouseCoordinate.printValue());
            var fontSize=$("#fontSizeId").val();
            var contentType=$("#contentTypeId").val();
            var contentCoordinateGroup = new ContentCoordinateGroup(
                mouseCoordinate.x,mouseCoordinate.y,fontSize,contentType);
            if(contentCoordinateGroup.isNumeric()) {
                var aValue=$("#numberAId").val();
                var bValue=$("#numberBId").val();
                var operatorValue=$("#operatorId").val();
                contentCoordinateGroup.setNumericContent(aValue,bValue,operatorValue);            
            }else{
                var contentText = $("#textId").val();
                contentCoordinateGroup.setContentText(contentText);
            }
            contentCoordinateGroup.adjust(canvas,Number(fontSize)/4);
            var contentCoordinateGroupWithinLimits = contentCoordinateGroup.isAnyWithinLimits(contentCoordinateGroupHistory);
            var nextCoordinateNumber;
            if(contentCoordinateGroupWithinLimits){
                console.log("near/on existing coordinate is being clicked");
                populateExistingCordinate(contentCoordinateGroupWithinLimits);
            }else{
                if( (contentCoordinateGroupHistory) && contentCoordinateGroupHistory.length > 0) {
                    nextCoordinateNumber = Number(contentCoordinateGroupHistory.length) + 1;
                }else{
                    nextCoordinateNumber = 1;
                }
                console.log("new coordinate is being clicked");
                $("#xId").val(contentCoordinateGroup.coordinate.x);
                $("#yId").val(contentCoordinateGroup.coordinate.y);
                //TODO: check for overlap.
                $("#numberAId").focus();
                $("#contentCoordinateGroupId").val("-1");
                $('#contentCoordinateGroupLabelId').text("Adding "+ nextCoordinateNumber);
                $("#editMessageDivId").text("");                
            }
        }
        /**
        http://www.html5canvastutorials.com/advanced/html5-canvas-mouse-coordinates/
        **/
        function getMouseCoordinate(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            var x = Math.round(evt.clientX - rect.left);
            var y = Math.round(evt.clientY - rect.top);
            var coordinate = new Coordinate(x,y);
            return coordinate;
        }

        function Coordinate(x,y) {
            //Will become an attribute of every instance of coordinate.
            this.x=Math.round(x);
            this.y=Math.round(y);
            this.printValue=function(){
                return "(x="+this.x+",y="+this.y+")";
            }
            this.getNumberX= function() {
                return Number(x);
            }
            this.getNumberY= function() {
                return Number(y);
            }
        }

        /**
        A content(element) at a given coordinate.
        **/
        function ContentCoordinate(x,y,content,fontSize) {
            this.content = content;
            this.coordinate = new Coordinate(x,y);
            this.fontSize=fontSize;
            this.draw=function(canvas) {
                addletter(canvas, this.content,
                 this.coordinate.x, this.coordinate.y,this.fontSize);
            }
            this.printValue = function() {
                return "Coordinate:"+this.coordinate.printValue()
                +",Content:"+this.content+" at Size:"+this.fontSize;
            }
        }

        function ContentRectangle(minX,minY,maxX,maxY) {
            //top left coordinate.
            this.min = new Coordinate(minX,minY);
            //top right coordinate.
            this.max = new Coordinate(maxX,maxY);
            this.isRectangleWithInXLimits=function(newRect) {
                var withinLimits= false;
                //TODO: make this part of coordinate.
                //INFO: The whole graph is on the 4th coordant.
                //the first condition is nothing but the rectangle being compared
                //to this(current) is to the left.
                //The second case is that the rectangle being compared is to the right.
                if( 
                    ( ( this.min.x <= newRect.max.x ) && ( this.max.x >= newRect.max.x ) ) ||
                    ( ( this.min.x <= newRect.min.x ) && ( this.max.x >= newRect.min.x ) )
                 ) {
                    console.log(this.printValue()+" is with in x limits of "+newRect.printValue());
                    withinLimits=true;
                }
                return withinLimits;
            }
            this.isRectangleWithInYLimits=function(newRect) {
                var withinLimits= false;
                if( 
                    ( ( this.min.y <= newRect.max.y ) && ( this.max.y >= newRect.max.y ) ) ||
                    ( ( this.min.y <= newRect.min.y ) && ( this.max.y >= newRect.min.y ) )
                 ) {
                    console.log(this.printValue()+" is with in y limits of "+newRect.printValue());
                    withinLimits=true;
                }
                return withinLimits;
            }            
            this.isRectangleWithInLimits=function(newRect){
                var withinLimits = this.isRectangleWithInXLimits(newRect);
                if(withinLimits){
                    withinLimits = this.isRectangleWithInYLimits(newRect);
                }
                return withinLimits;
            }
            this.printValue=function() {
                return this.min.printValue()+","+this.max.printValue();
            }
        }

        //INFO:Class ContentCoordinateGroup, group text starting at a particular coordinate.
        //Say, starting at x,y display 33+40=__. 
        //Functions:
        //1. Any time it exceeds coordinates of canvas re-adjust.
        //2. Any time this falls with in range of another co-ordinate,
        //do not return the instance.
        //3. Given x,y , calculate appropriately for A,B,operator and ___ text.

        function ContentCoordinateGroup(x, y,fontSize,contentType) {
            this.coordinate=new Coordinate(x,y);
            this.fontSize=fontSize;
            this.id=-1;
            this.editReason="";
            this.contentType=contentType;

            this.a=-1;
            this.b=-1;
            this.operator="";

            this.aCoordinate;
            this.bCoordinate;
            this.line1Coordinate;
            this.line2Coordinate;
            this.operatorCoordinate;

            this.contentText="";

            this.setId=function(id){
                this.id=id;
            }
            this.setA=function(a){
                this.a=a;
            }
            this.setB=function(b){
                this.b=b;
            }
            this.setOperator=function(operator){
                this.operator=operator;
            }
            this.isNumeric=function(contentType){
                if(contentType) {
                    return contentType === CONTENT_TYPE_NUMERIC;
                } else {
                    return this.contentType === CONTENT_TYPE_NUMERIC;                    
                }
            }
            this.isText=function(contentType){
                if(contentType) {
                    return contentType === CONTENT_TYPE_TEXT;
                } else {
                    return this.contentType === CONTENT_TYPE_TEXT;                    
                }
            }
            this.setNumericContent = function(a,b,operator) {
                this.setA(a);
                this.setB(b);
                this.setOperator(operator);
            }
            this.setContentText=function(contentText) {
                this.contentText=contentText;
            }
            this.adjust = function (canvas,padding) {
                console.log("adjust");
                //INFO: Calculate space taken by 40 px character.
                var delta =  Number(Number(this.fontSize)*(Math.max(this.a.length,this.b.length)));
                var max = Number(Math.max(this.a.length,this.b.length));
                //left, top, right, bottom, x, y, width, height
                var canvasBounds = canvas.getBoundingClientRect();
                var lineLength = Number(this.fontSize)*Number(this.getLineLength());

                console.log("canvasBounds.x:"+canvasBounds.x);
                console.log("canvasBounds.left:"+canvasBounds.left);
                console.log("canvasBounds.right:"+canvasBounds.right);
                console.log("delta: "+fontSize+"*(Math.max(a.length,b.length)):"
                    +delta);
                console.log("lineLength:"+lineLength);
                console.log("canvasBounds.top:"+canvasBounds.top);
                console.log("canvasBounds.bottom:"+canvasBounds.bottom);
                console.log("canvasBounds.y:"+canvasBounds.y);
                console.log("coordinate coordinate:"+this.coordinate.printValue());

                //INFO: Where i click is where the coordinate of the symbol gets written.
/**
                33%
                44
                --
                __
                this.getMaxX=function(padding){
                    return Math.round(Number(this.coordinate.x)
                     + Number(padding)+ (Number(fontSize)/1.5));                
                }                
**/
                //INFO: align to right margin.
                if( (Number(this.coordinate.x) + Number(padding)
                 + (Number(fontSize)/1.5) + canvasBounds.left)  > canvasBounds.right) {
                    console.log("readjusted x for right bounds from x :"+this.coordinate.x);
                    console.log("Number(canvasBounds.right)"+
                     "- Number(padding) -"+
                      "- (Number(fontSize)/1.5) - canvasBounds.left");
                    console.log(Number(canvasBounds.right)+
                     "-"+ Number(padding) +"-"+
                     (Number(fontSize)/1.5) +"-"+ canvasBounds.left);
                    this.coordinate.x = Math.round(
                        Number(canvasBounds.right)
                     - Number(padding)
                      - (Number(fontSize)/1.5) - Number(canvasBounds.left));
                    console.log("to :"+this.coordinate.x);
                }
                //INFO: align to left margin.
                //TODO: works correctly for large numbers, but for single digits too much spacing.                
                if(
                 Number(this.coordinate.x)  <
                 (Number(padding) + Number(lineLength)*0.50 + Number(fontSize) ) 
                 ) {
                    console.log("readjusted x for left bounds from x :"+x);
                    this.coordinate.x = Number(padding) + Number(lineLength)*0.50 + Number(fontSize);
                    console.log("to :"+this.coordinate.x);
                }
                //INFO:Basically adjusting for
                // 32
                //+44
                //=76
                //3 font sizes,3*40=120
                console.log("( Number(y) + Number(canvasBounds.top) + (3*Number(this.fontSize)) ) > canvasBounds.bottom");
                console.log(( Number(this.coordinate.y) + Number(canvasBounds.top) + (3*Number(this.fontSize)) ) + " > " + canvasBounds.bottom);
                if( ( Number(this.coordinate.y) + Number(canvasBounds.top) + (3*Number(this.fontSize)) ) > canvasBounds.bottom) {
                    console.log("readjusted y for bottom from y :"+y);
                    this.coordinate.y = canvasBounds.bottom - Number(canvasBounds.top) - (3*Number(this.fontSize));
                    console.log("to :"+this.coordinate.y);
                }
                //INFO: the numbers are starting somewhere in the middle, so ensuring 1 font size gap at top
                console.log("( Number(y) + Number(canvasBounds.top) - Number(this.fontSize) ) < canvasBounds.top");
                console.log( ( Number(this.coordinate.y) + Number(canvasBounds.top) - Number(this.fontSize) ) + " < " + canvasBounds.top);
                if( ( Number(this.coordinate.y) + Number(canvasBounds.top) - Number(this.fontSize) ) < canvasBounds.top) {
                    console.log("readjusted y for top from y :"+this.coordinate.y);
                    this.coordinate.y = canvasBounds.top - Number(canvasBounds.top) + Number(this.fontSize);
                    console.log("to :"+this.coordinate.y);
                }
                this.initializeCoordinates();
            }
            this.initializeCoordinates = function() {
                this.aCoordinate = new ContentCoordinate(this.coordinate.x,this.coordinate.y,this.a,this.fontSize);
                console.log("aCoordinate:"+this.aCoordinate.printValue());

                this.bCoordinate = new ContentCoordinate(this.coordinate.x,
                    (Number(this.coordinate.y) + Number(this.fontSize))
                    ,this.b,this.fontSize);
                console.log("bCoordinate:"+this.bCoordinate.printValue());

                this.line1Coordinate = new ContentCoordinate(
                    this.coordinate.x,
                    (Number(this.coordinate.y) + (Number(1.25)*Number(this.fontSize))),
                    this.getLine(),this.fontSize                    
                    );
                console.log("line1Coordinate:"+this.line1Coordinate.printValue());

                this.line2Coordinate = new ContentCoordinate(
                    this.coordinate.x,
                    (Number(this.coordinate.y) + (Number(2.5)*Number(this.fontSize))),
                    this.getLine(),this.fontSize
                    );
                console.log("line2Coordinate:"+this.line2Coordinate.printValue());

                var x1 = Number(this.coordinate.x)+Number(this.fontSize);
                var y1 = Number(this.coordinate.y)+Number(this.fontSize)/2;
                this.operatorCoordinate = new ContentCoordinate(
                    x1,y1,
                    this.operator,this.fontSize
                    );
                console.log("operatorCoordinate:"+this.operatorCoordinate.printValue());
            }
            this.getLineLength = function() {
                var lineLength = Math.max(this.a.length,this.b.length);
                console.log("Line Length a or b:"+lineLength);
                return lineLength;
            }
            this.getLine = function() {
                //TODO: Note, you may have to bind "this" to correct object instance.
                //to avoid confusion with in js.
                var lineLength = this.getLineLength();
                var line="";
                while(lineLength > 0) {
                    line = line + "_";
                    lineLength = lineLength - 1;
                }
                return line;   
            }
            this.getMinX=function(padding){
                var lineLength = Number(fontSize)*Number(this.getLineLength());
                ///1.5 because modulus operator is bigger.
                return Math.round(
                    Number(this.coordinate.x) - Number(padding) - (Number(lineLength)*0.50)
                    - Number(fontSize)
                    );
            }
            this.getMaxX=function(padding){
                return Math.round(Number(this.coordinate.x)
                 + Number(padding) + (Number(fontSize)/1.5) );                
            }
            this.getMinY=function(padding){
                return Math.round(Number(this.coordinate.y) - Number(padding));
            }
            this.getMaxY=function(padding){
                var verticalHeight = Number(fontSize)*Number(3.5);
                return Math.round(Number(this.coordinate.y) + Number(padding) + Number(verticalHeight));
            }
            this.addText = function(canvas) {
                console.log("Adding text:"+this.printValue());
                addletter(canvas, this.contentText, this.coordinate.x, this.coordinate.y,this.fontSize);
            }
            this.draw=function(canvas) {
                console.log("contentCoordinateGroup:"+this.printValue());
                if(this.isNumeric()) {
                    this.aCoordinate.draw(canvas);
                    this.bCoordinate.draw(canvas);
                    this.operatorCoordinate.draw(canvas);
                    this.line1Coordinate.draw(canvas);
                    this.line2Coordinate.draw(canvas);
                }else{
                    this.addText(canvas);
                }
            }
            this.getContentRectangle=function(padding){
                var contentRectangle=new ContentRectangle(
                    this.getMinX(padding),
                    this.getMinY(padding),
                    this.getMaxX(padding),
                    this.getMaxY(padding)
                    );
                console.log("contentRectangle is "+contentRectangle.printValue());
                return contentRectangle;
            }
            this.isAnyWithinLimits = function(contentCoordinateGroupHistory) {
                var contentCoordinateGroupWithinLimits = null;
                if( (contentCoordinateGroupHistory) && contentCoordinateGroupHistory.length > 0) {
                    for (var j = 0; j < contentCoordinateGroupHistory.length; j++){
                        console.log("Checking "
                         + contentCoordinateGroupHistory[j].printValue() +" with "+ this.printValue());
                        //TODO: do whether the clicked coordinates are with in limits, on click, instead of
                        //doing it on click of "Done" button
                        withinLimits = contentCoordinateGroupHistory[j].isWithinLimits(this);
                        if(withinLimits) {
                            console.log("With in limits:" + withinLimits);
                            contentCoordinateGroupWithinLimits = contentCoordinateGroupHistory[j];
                            j = contentCoordinateGroupHistory.length;
                        }
                    }
                }
                return contentCoordinateGroupWithinLimits;
            }            
            this.isWithinLimits = function(contentCoordinateGroup) {
                console.log("checking :"+this.printValue() +
                    "against contentCoordinateGroup:"+contentCoordinateGroup.printValue());
                var withinLimits=false;
                var contentRectangle = this.getContentRectangle(Math.round(Number(this.fontSize)/4));
                var newContentRectagle = contentCoordinateGroup.getContentRectangle(Math.round(Number(contentCoordinateGroup.fontSize)/4));
                console.log("Comparing this"+contentRectangle.printValue() +"with"+newContentRectagle.printValue());
                withinLimits=contentRectangle.isRectangleWithInLimits(newContentRectagle);
                return withinLimits;
            }
            this.printValue= function() {
                if(this.isNumeric()) {
                    return "id="+this.id+" ("+this.x+","+ this.y+") : "+this.aCoordinate.content+this.operatorCoordinate.content+this.bCoordinate.content+"=?";
                } else{
                    return "id="+this.id+" ("+this.contentText+")";
                }
            }            
        }

        //INFO:Instead of adding it on load, if we add it as event based on canvas element,
        //then it can be re-used across pages.
        //Later this can also be made data driven.
        //canvas.addEventListener("keyup", keyUpHandler, true);
        //canvas.addEventListener('mousemove',mouseMoveHandler,true);

        function addletter(canvas, letter, x, y,fontSize) {
            var context = canvas.getContext("2d");
            context.font = fontSize+"pt Calibri";
            context.textAlign = "right";
            context.fillText(letter, x, y );
        }

		//Validate the input and add text.
		function validateInput() {
            var letterA = $('#numberAId').val();
            //TODO: explain the regex.
             if (/\D/.test(letterA)) {
				alert( letterA + " is not a number. Please enter a valid number for A." );
            	$('#numberAId').focus() ;
            	return false; 
            }
            //TODO: explain regex.
            var letterB = $('#numberBId').val();                       
            if (/\D/.test(letterB)) {
				alert( letterB + " is not a number. Please enter a valid number for B." );
            	$('#numberBId').focus() ;
            	return false; 
            }
            addContent();
        }
        function addContent() {
            console.log("adding content");
            //INFO: common to both contentCoordinateGroup of type text and numeric.
            var x=$('#xId').val();
            var y=$('#yId').val();
            var fontSize = $('#fontSizeId').val();
            var canvas = document.getElementById("myCanvas");
            var contentCoordinateGroupId=$('#contentCoordinateGroupId').val();
            var contentType=$('#contentTypeId').val();
            var contentCoordinateGroupWithinLimits;
            //INFO: Editing existing coordinate.
            var currentContentCoordinateGroup;

            //INFO: specific to numeric content coordinate group.

            var contentCoordinateGroup = new ContentCoordinateGroup(x,y,fontSize,contentType);
            if(contentCoordinateGroup.isNumeric()) {
                var letterA = $('#numberAId').val();
                var letterB = $('#numberBId').val();
                var operator = $('#operatorId').val();
                contentCoordinateGroup.setNumericContent(letterA,letterB,operator);
            }else{
                var contentText = $('#textId').val();
                contentCoordinateGroup.setContentText(contentText,operator);
            }
            //INFO: adjust it, just in case x and y are edited.
            contentCoordinateGroup.adjust(canvas);

            if(contentCoordinateGroupId>0) {
                console.log("Editing contentCoordinateGroupId"+contentCoordinateGroupId);
                x=contentCoordinateGroup.coordinate.x;
                y=contentCoordinateGroup.coordinate.y;
                $('#xId').val(x);
                $('#yId').val(y);            
                contentCoordinateGroup.setId(contentCoordinateGroupId);
                contentCoordinateGroupHistory[contentCoordinateGroupId-1]=contentCoordinateGroup;
                console.log("Redrawing");
                erase(canvas);
                //TODO: this needs to be written from, javascript array.
                draw();
                console.log("total:"+contentCoordinateGroupHistory.length);
                for (var j = 0; j < contentCoordinateGroupHistory.length; j++){
                    currentContentCoordinateGroup = contentCoordinateGroupHistory[j];
                    currentContentCoordinateGroup.draw(canvas);
                }
                //INFO: End of editing existing coordinate.
            }else{
                //INFO: adding a new coordinate.
                //INFO: checking if new coordinate is with in limits of any of old coordinates.
                contentCoordinateGroupWithinLimits = contentCoordinateGroup.isAnyWithinLimits(contentCoordinateGroupHistory);
                if(contentCoordinateGroupWithinLimits == null) {
                    console.log("Adding new values");
                    x=contentCoordinateGroup.coordinate.x;
                    y=contentCoordinateGroup.coordinate.y;
                    $('#xId').val(x);
                    $('#yId').val(y);            
                    //TODO: do contentCoordinateGroup.draw, that does the 5 things below.
                    contentCoordinateGroup.draw(canvas);
                    addToHistory(contentCoordinateGroup);
                    console.log("total"+contentCoordinateGroupHistory.length);                
                }else {
                    console.log("New value is existing value, so Populating existing values");
                    contentCoordinateGroupWithinLimits.editReason="Because Space for 1 digit, instead of "+ contentCoordinateGroup.getLineLength() + " digits.";
                    //INFO: populate x,y a,b,operator and TODO: id.
                    populateExistingCordinate(contentCoordinateGroupWithinLimits);
                }
            }
        }
        function populateCoordinate(contentCoordinateGroup) {
            $('#xId').val(contentCoordinateGroup.coordinate.x);
            $('#yId').val(contentCoordinateGroup.coordinate.y);
            if(contentCoordinateGroup.isNumeric()) {
                onContentChange(contentCoordinateGroup.contentType);
                //TODO: change dropdown and populate values...
                //TODO: repopulate A and B, only if pre-populate existing is selected. 
                //default is it is NOT selected.            
                $('#numberAId').val(contentCoordinateGroup.a);
                $('#numberBId').val(contentCoordinateGroup.b);
                $('#operatorId').val(contentCoordinateGroup.operator);
            } else{
                onContentChange(contentCoordinateGroup.contentType);
                $('#textId').val(contentCoordinateGroup.contentText);
            }
        }
        function populateExistingCordinate(contentCoordinateGroupWithinLimits) {
            populateCoordinate(contentCoordinateGroupWithinLimits);
            $('#contentCoordinateGroupId').val(contentCoordinateGroupWithinLimits.id);     
            $('#contentCoordinateGroupLabelId').text("Editing #"+contentCoordinateGroupWithinLimits.id);     
            $('#editMessageDivId').text(contentCoordinateGroupWithinLimits.editReason);     
        }
        function showInputs() {
            $("#leftDivId").show();
            $("#rightDivId").show();
            $("#bannerDivId").width(1600);     
        }
        function hideInputs() {
            $("#leftDivId").hide();
            $("#rightDivId").hide();       
            $("#bannerDivId").width(1000);     
        }
        function onContentChange(inContentType) {
            var contentType = "";
            if(inContentType) {
                contentType = inContentType;
            }else {
                contentType = $("#contentTypeId").val();
            }
            console.log("Content Type is "+contentType);
            //TODO: good to have, not must have, organize in div or field sets.
            if(contentType==="Text") {
                $("#numberAId").hide();
                $("#numberBId").hide();
                $("#operatorId").hide();
                $("#numberALabelId").hide();
                $("#numberBLabelId").hide();
                $("#operatorLabelId").hide();
                $("#textId").show();
                $("#textLabelId").show();
            }else{
                $("#numberAId").show();
                $("#numberBId").show();
                $("#operatorId").show();
                $("#numberALabelId").show();
                $("#numberBLabelId").show();
                $("#operatorLabelId").show();
                $("#textId").hide();
                $("#textLabelId").hide();
            }
        }
        function prefillImage() {
            console.log("prefillImage");
        }
    </script>

</body>

</html>