<!DOCTYPE html>
<html>

<head>
    <title>Math And Color</title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

</head>
<style type="text/css">
h1 {
   text-align:center;
   margin-left: 1cm;
   /**aligning crudely with canvas**/
   margin-right: 15cm;
}
#myCanvas {
   text-align:center;
   margin-left: 1cm;
}
#inputsId {
   margin-left: 1cm;
   margin-right: 15cm;
}
label {
  width: 100px;
  padding-right: 20px;
  display: inline-block;
}
canvas {
   display: inline;
}
</style>
<body>

<div>
    <h1>Learn And Color</h1>
    <div class="form-group"  id="inputsId">
        <fieldset>
            <label for="xId">X:</label>
            <input class="form-control" type="name" id="xId" placeholder="X"/>
            <label for="yId">Y:</label>
            <input class="form-control" type="name" id="yId" placeholder="Y"/>
            <label for="fontSizeId">Font Size:</label>
            <input class="form-control" type="name" id="fontSizeId" value="40"/>
        </fieldset>
        <br/>
        <fieldset>
            <label for="numberAId">A:</label>
            <input class="form-control" type="name" id="numberAId" placeholder="Enter Number A"/>
            <br/>
            <br/>
            <label for="operatorId">Operator:</label>
            <input class="form-control" type="name" id="operatorId" placeholder="Operator"/>
            <br/>
            <br/>
            <label for="numberBId">B:</label>
            <input class="form-control" type="name" id="numberBId" placeholder="Enter Number B"/>
            <br/>
            <br/>
            <label for="doneId">Numbers will Appear</label>
            <button class="form-control" id="doneId" onclick="addText()">Done</button>
            <button class="form-control" id="hideId" onclick="hideInputs()">Hide</button>
            <br/>
            <br/>
        </fieldset>
        <br/>
    </div>

    <!--http://stackoverflow.com/questions/12886286/addeventlistener-for-keydown-on-canvas
    Added tab index, to make canvas focusable. Unlike other html elements, it is NOT
    focusable by default.
    -->

    <canvas id="myCanvas" width="1000" height="1000" style="border:1px solid #d3d3d3;" tabindex="1" 
    onclick="mouseMoveHandler(this,event)">
        Your browser does not support the HTML5 canvas tag.
    </canvas>
    <div>
        You can use this space to display (x,y) coordinates,and its text
    </div>

    </div>
    <script type="text/javascript">
        var keyHistoryCoordinate={keyHistory:"This is at (10,10)", x:10, y:10};
        var keyCoordinateHistory=[keyHistoryCoordinate];
        var FONT_SIZE = $('#fontSizeId').val();

        var keyHistory = "";
        var mousePos;
        window.onload = function() {
            draw();
        };
        //INFO: outside of onload
        function draw() {
            var canvas = document.getElementById("myCanvas");
            var context = canvas.getContext("2d");
            var imageObj = new Image();
            imageObj.onload = function() {
                //width="1160" height="1008"
                context.drawImage(imageObj, 10, 10, 1160, 1008);
                context.font = FONT_SIZE+"pt Calibri";
                context.fillText("Name:", 30, FONT_SIZE);
                //Fill your name
                context.fillText("__________", 30, (3*Number(FONT_SIZE)));
                context.fillText("_______", 30, (5*Number(FONT_SIZE)));
            };
            imageObj.src = "dora-the-explorer-coloring-pages-pdf-coloring-pages-printable-coloring-pages-pdf.gif";
        }

        function keyUpHandler(canvas, event) {
            //alert('hi keyup');
            //INFO:TODO: mouse position comes only from mouse listener not key listener
            //http://stackoverflow.com/questions/12886286/addeventlistener-for-keydown-on-canvas
            //http://jsfiddle.net/AustinBrunkhorst/qsULv/
            //INFO: capture the last position of mouse, by mouse listener.
            //on key down, write to the last known position of the mouse.
            //var mousePos = getMousePos(canvas, event);
            //var letters = "abcdefghijklmnopqrstuvwxyz";
            //var key = event.keyCode;
            //if (key > 64 && key < 91) {
                //var letter = letters.substring(key - 64, key - 65);
                //INFO: just incase it is hidden by the user.
                showInputs();
                var letter = getKey(event);
                addletter(canvas, letter, mousePos.x, mousePos.y);
            //}
        }

        function mouseMoveHandler(canvas, event) {
            showInputs();
            mousePos = getMousePos(canvas, event);
            $("#xId").val(mousePos.x);
            $("#yId").val(mousePos.y);
            $("#numberAId").focus();
        }
        /**
        http://www.html5canvastutorials.com/advanced/html5-canvas-mouse-coordinates/
        **/
        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            var x = Math.round(evt.clientX - rect.left);
            var y = Math.round(evt.clientY - rect.top);
            return {
                x: x,
                y: y
            };
        }

        //INFO:Class TextCoordinate, group text starting at a particular coordinate.
        //Say, starting at x,y display 33+40=__. 
        //Functions:
        //1. Any time it exceeds coordinates of canvas re-adjust.
        //2. Any time this falls with in range of another co-ordinate,
        //do not return the instance.
        //3. Given x,y , calculate appropriately for A,B,operator and ___ text.

        function TextCoordinate (x, y, a,b,operator) {
            this.x = x;
            this.y = y;
            this.a = a;
            this.b = b;
            this.operator = operator;
            this.adjust = function (canvas) {
                console.log("adjust");
                //INFO: Calculate space taken by 40 px character.
                var delta =  Number(Number(FONT_SIZE)*(Math.max(a.length,b.length)));
                //left, top, right, bottom, x, y, width, height
                var canvasBounds = canvas.getBoundingClientRect();
                console.log("canvasBounds.x:"+canvasBounds.x);
                console.log("canvasBounds.left:"+canvasBounds.left);
                console.log("canvasBounds.right:"+canvasBounds.right);
                console.log("Number(x):"+Number(x));
                console.log("delta: "+FONT_SIZE+"*(Math.max(a.length,b.length)):"
                    +delta);
                console.log("canvasBounds.top:"+canvasBounds.top);
                console.log("canvasBounds.bottom:"+canvasBounds.bottom);
                console.log("canvasBounds.y:"+canvasBounds.y);
                console.log("Number(y):"+Number(y));

                //INFO: align to right margin.
                if( (Number(x)+Number(delta)+canvasBounds.left)  > canvasBounds.right) {
                    console.log("readjusted x for right bounds from x :"+x);
                    this.x = Number(canvasBounds.right) - Number(delta) - canvasBounds.left;
                    console.log("to :"+this.x);
                }
                //INFO: align for the one -/+/* character
                if( (Number(x)+canvasBounds.left-Number(FONT_SIZE))  < canvasBounds.left) {
                    console.log("readjusted x for left bounds from x :"+x);
                    this.x = Number(FONT_SIZE);
                    console.log("to :"+this.x);
                }
                //INFO:Basically adjusting for
                // 32
                //+44
                //=76
                //3 font sizes,3*40=120
                console.log("( Number(y) + Number(canvasBounds.top) + (3*Number(FONT_SIZE)) ) > canvasBounds.bottom");
                console.log(( Number(y) + Number(canvasBounds.top) + (3*Number(FONT_SIZE)) ) + " > " + canvasBounds.bottom);
                if( ( Number(y) + Number(canvasBounds.top) + (3*Number(FONT_SIZE)) ) > canvasBounds.bottom) {
                    console.log("readjusted y for bottom from y :"+y);
                    this.y = canvasBounds.bottom - Number(canvasBounds.top) - (3*Number(FONT_SIZE));
                    console.log("to :"+this.y);
                }
                //INFO: the numbers are starting somewhere in the middle, so ensuring 1 font size gap at top
                console.log("( Number(y) + Number(canvasBounds.top) - Number(FONT_SIZE) ) < canvasBounds.top");
                console.log( ( Number(y) + Number(canvasBounds.top) - Number(FONT_SIZE) ) + " < " + canvasBounds.top);
                if( ( Number(y) + Number(canvasBounds.top) - Number(FONT_SIZE) ) < canvasBounds.top) {
                    console.log("readjusted y for top from y :"+y);
                    this.y = canvasBounds.top - Number(canvasBounds.top) + Number(FONT_SIZE);
                    console.log("to :"+this.y);
                }
            }

            this.getBCoordinate = function(){
                console.log("Number(FONT_SIZE)"+Number(FONT_SIZE));
                return {
                    x: this.x,
                    y: (Number(this.y) + Number(FONT_SIZE))
                };
            }
            this.getLineLength = function() {
                var lineLength = Math.max(a.length,b.length);
                console.log("Line Length"+lineLength);
                return lineLength;
            }
            this.getLine1Coordinate = function(){
                console.log("Number(FONT_SIZE)"+Number(FONT_SIZE));
                return {
                    x: this.x,
                    y: (Number(this.y) + (Number(1.25)*Number(FONT_SIZE)))
                };
            }
            this.getLine2Coordinate = function(){
                console.log("Number(FONT_SIZE)"+Number(FONT_SIZE));
                return {
                    x: this.x,
                    y: (Number(this.y) + (Number(2.5)*Number(FONT_SIZE)))
                };
            }
            this.getOperatorCoordinate = function() {
                var x1 = Number(x1)-Math.round(Number(FONT_SIZE)/2);
                var y1 = Number(y1)+Math.round(Number(FONT_SIZE)/2);
                return {
                    x:x1,
                    y:y1
                }
            }            
        }

        //INFO:Instead of adding it on load, if we add it as event based on canvas element,
        //then it can be re-used across pages.
        //Later this can also be made data driven.
        //canvas.addEventListener("keyup", keyUpHandler, true);
        //canvas.addEventListener('mousemove',mouseMoveHandler,true);
        //alert('hi');

        function addletter(canvas, letter, x, y) {
            var context = canvas.getContext("2d");
            //keyHistory += letter;
            //INFO: clears a lot of area so commented.
            //context.clearRect(x, y, x+20, y+50);
            context.fillText(letter, x, y );
        }

        function addLetterToA(canvas,numberA,textCoordinate) {
            console.log("Adding letter to A");
            console.log("canvassing...");
            console.log("adding...(x,y)=("+textCoordinate.x+","+textCoordinate.y+")");
            addletter(canvas, numberA, textCoordinate.x, textCoordinate.y);
            console.log("added...");
        }
        function addLetterToB(canvas,numberB,textCoordinate) {
            console.log("Adding letter to B");
            console.log("canvassing...");
            var bCoordinate=textCoordinate.getBCoordinate();
            console.log("adding...(x,y)=("+bCoordinate.x+","+bCoordinate.y+")");
            //INFO: write in next line.
            addletter(canvas, numberB, bCoordinate.x, bCoordinate.y);
            console.log("added...");            
        }
        function addLine1(canvas,letterA,letterB,textCoordinate) {
            console.log("Adding line1");
            console.log("canvassing...");
            var line1Coordinate=textCoordinate.getLine1Coordinate();
            console.log("adding...(x,y)=("+line1Coordinate.x+","+line1Coordinate.y+")");
            var lineLength = textCoordinate.getLineLength();
            var line="";
            while(lineLength > 0) {
                line = line + "_";
                lineLength = lineLength - 1;
            }
            //INFO: write in next line.
            addletter(canvas, line, line1Coordinate.x, line1Coordinate.y);
            console.log("added...");            
        }       
        function addLine2(canvas,letterA,letterB,textCoordinate) {
            console.log("Adding line2");
            console.log("canvassing...");
            var line2Coordinate=textCoordinate.getLine2Coordinate();
            console.log("adding...(x,y)=("+line2Coordinate.x+","+line2Coordinate.y+")");
            //INFO: write in next line.
            var lineLength = textCoordinate.getLineLength();
            var line="";
            while(lineLength > 0) {
                line = line + "_";
                lineLength = lineLength - 1;
            }            
            addletter(canvas, line, line2Coordinate.x, line2Coordinate.y);
            console.log("added...");            
        }           
        function addLetterToOperator(canvas,operator,textCoordinate){
            //TODO: refactor this function.
            console.log("Adding letter to Operator");
            console.log("canvassing...");
            var operatorCoordinate = textCoordinate.getOperatorCoordinate();
            console.log("adding...(x1,y1)=("+operatorCoordinate.x+","+operatorCoordinate.y+")");
            //INFO: write it between 2 numbers, slightly to left
            addletter(canvas, operator, operatorCoordinate.x, operatorCoordinate.y);
            console.log("added...");
        }
        function addText() {
            var x=$('#xId').val();
            var y=$('#yId').val();
            var letterA = $('#numberAId').val();
            var letterB = $('#numberBId').val();
            var operator = $('#operatorId').val();
            var canvas = document.getElementById("myCanvas");

            var textCoordinate = new TextCoordinate(x,y,letterA,letterB,operator);
            textCoordinate.adjust(canvas);
            x=textCoordinate.x;
            y=textCoordinate.y;
            $('#xId').val(x);
            $('#yId').val(y);            
            addLetterToA(canvas,letterA,textCoordinate);
            addLetterToOperator(canvas,operator,textCoordinate);
            addLetterToB(canvas,letterB,textCoordinate);
            addLine1(canvas,letterA,letterB,textCoordinate);
            addLine2(canvas,letterA,letterB,textCoordinate);
        }
        function showInputs() {
            $("#inputsId").show();
        }
        function hideInputs() {
            $("#inputsId").hide();
        }
    </script>

</body>

</html>